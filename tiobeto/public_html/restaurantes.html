<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="css/restaurantes.min.css" />
        <link rel="stylesheet" href="css/jquery.mobile.icons.min.css" />
        <link rel="stylesheet" href="css/jquery.mobile.structure-1.4.2.min.css" />
        <link rel="stylesheet" href="css/style.css" />
        <script src="js/jquery-1.11.1.min.js"></script>
        <script src="js/jquery.mobile-1.4.2.min.js"></script>
        <script src="js/app.js"></script>
        <script src="phonegap.js" type="text/javascript"></script>
        <script>

            document.addEventListener("deviceready", onDeviceReady, false);
            document.addEventListener("menubutton", onMenuKeyDown, false);

            function onMenuKeyDown() {
                $("#btnMenu").click();
            }

            function onDeviceReady() {

                mostrarRestaurantes();
            }

            function mostrarRestaurantes() {
                var $this = $(this),
                        theme = $this.jqmData("theme") || $.mobile.loader.prototype.options.theme,
                        msgText = $this.jqmData("msgtext") || $.mobile.loader.prototype.options.text,
                        textVisible = $this.jqmData("textvisible") || $.mobile.loader.prototype.options.textVisible,
                        textonly = !!$this.jqmData("textonly");
                html = $this.jqmData("html") || "";
                $.mobile.loading("show", {
                    text: msgText,
                    textVisible: textVisible,
                    theme: theme,
                    textonly: textonly,
                    html: html
                });
                var idTipo = localStorage.getItem("idTipo");


                //var url = "http://192.168.1.33/domicilios/restaurante/consultarRestaurantesPorTipo";
                var url = "http://tudomicilio.liceogalois.com/restaurante/consultarRestaurantesPorTipo";
                //var url = "/domicilios/restaurante/consultarRestaurantesPorTipo";
                $.ajax({
                    type: "POST",
                    url: url,
                    data: {
                        idTipo: idTipo
                    }
                })
                        .done(function(msg) {
                            $("#lista").hide();
                            var json = eval("(" + msg + ")");

                            for (var i = 0; i < json.length; i++) {
                                if (json[i].estado == "a"){
                                    $("#lista").append('<li><a href="#" onclick="mostrarRestaurante(' + json[i].id + ')"><img src="http://tudomicilio.liceogalois.com/utiles/imagenes/restaurantes/' + json[i].id + '.png"><h2>' + json[i].nombre + '</h2><p>' + json[i].descripcion + '</p></a></li>');
                                }else if (json[i].estado == "c") {
                                    $("#lista").append('<li><a href="#" onclick="mostrarRestaurante(' + json[i].id + ')"><img src="http://tudomicilio.liceogalois.com/utiles/imagenes/restaurantes/' + json[i].id + '.png"><h2>' + json[i].nombre + ' <span style="font-size: 9px"> (cerrado) </span></h2><p>' + json[i].descripcion + '</p></a></li>');
                                }
                            }
                            setTimeout(function() {
                                $('#lista').show();
                                $('#lista').listview('refresh');
                                $.mobile.loading("hide");
                            }, 1000);

                        });




            }

            function mostrarRestaurante(idRestaurante) {

                localStorage.setItem("idRestaurante", idRestaurante);
                location.href = "mostrarRestaurante.html";

            }
        </script>
    </head>
    <body>
        <div data-role="page" id="pagina">
            <div data-role="header" data-position="fixed" data-fullscreen="false">
                <a href="#" style="border: none; background-color: #c5021a;  box-shadow: none; margin-top: 11px" onclick="atras()" class="ui-nodisc-icon ui-btn ui-shadow ui-corner-all ui-icon-carat-l ui-btn-icon-notext ui-btn-a ui-btn-inline">Atras</a>
                <h3><img  src="image/header.png" style="width: 130px;margin-top: 4px" /></h3>
                <a href="#menu" id="btnMenu" style="border: none; background-color: #c5021a; box-shadow: none; margin-top: 11px" class="ui-nodisc-icon ui-btn ui-shadow ui-corner-all ui-icon-bars ui-btn-icon-notext ui-btn-a ui-btn-inline">Menù</a>
            </div>
            <div data-role="panel" data-display="overlay" data-position="right" id="menu">
                <input type="search" name="buscaRestaurante" id="buscaRestaurante" placeholder="Buscar Lugar">
                <br>
                <ul data-role="listview">
                    <li data-icon="home"><a data-ajax="false" href="index.html">Inicio</a></li>
                    <li data-icon="check"><a id="iniciar" data-ajax="false" href="iniciarSesion.html">Inicia Sesión</a></li>
                    <li data-icon="user"><a  id="perfil" data-ajax="false" href="perfil.html">Tu Perfil</a></li>
                    <li data-icon="info"><a id="estados" href="estado.html" data-ajax="false">Estado de Tus Domicilios</a></li>
                    <li data-icon="bullets"><a href="servicios.html" data-ajax="false">Otros Servicios</a></li>
                    <li data-icon="star"><a href="#" data-ajax="false" onclick="alert('Esta función estará disponible proximamente')">Favoritos</a></li>
                    <li data-icon="location"><a data-ajax="false" href="verCercanos.html">Lugares Cercanos</a></li>
                    <li data-icon="shop"><a data-ajax="false" href="tipoRestaurantes.html">Restaurantes</a></li>
                    <li data-icon="power"><a data-ajax="false" id="cerrar" href="#" onclick="cerrarSesion()">Cerrar Sesión</a></li>
                </ul>
            </div><!-- /panel -->

            <div role="main" class="ui-content">
                <ul data-role="listview" data-filter="true" data-filter-placeholder="Busqueda Rápida..." data-inset="false" id="lista">

                </ul>
            </div>

        </div>
    </body>
</html>