<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="css/tiobeto.min.css" />
        <link rel="stylesheet" href="css/jquery.mobile.icons.min.css" />
        <link rel="stylesheet" href="css/jquery.mobile.structure-1.4.2.min.css" />
        <link rel="stylesheet" href="css/style.css" />
        <link rel="stylesheet" href="css/responsiveslides.css" />
        <link href="css/chardinjs.css" rel="stylesheet">
        <script src="js/jquery-1.11.1.min.js"></script>
        <script src="js/jquery.mobile-1.4.2.min.js"></script>
        <script src="js/jquery.liveSearch.js"></script>
        <script src="js/responsiveslides.min.js"></script>
        <script src="js/app.js"></script>
        <script src="phonegap.js" type="text/javascript"></script>
        <script type="text/javascript" charset="utf-8" src="PushNotification.js"></script>   
        <script src="cdv-plugin-fb-connect.js"></script>
        <script src="facebook-js-sdk.js"></script>
        <script src="js/chardinjs.js"></script>
        <script>

            document.addEventListener("deviceready", onDeviceReady, false);
            document.addEventListener("resume", onResume, false);
            document.addEventListener("menubutton", onMenuKeyDown, false);
            
            $(document).ready(function(){
                $("#slider").responsiveSlides({
                    maxwidth: 800,
                    speed: 2000
                });
                if(localStorage.getItem("ayuda")=="" || localStorage.getItem("ayuda")==null){
                    localStorage.setItem("ayuda","true");
                    //$('body').chardinJs('start');
                }
                 
                 $('body').click(function(){
                    $('body').chardinJs('stop');
                });
            });
            
            function onMenuKeyDown() {
                $("#btnMenu").click();
            }
            function onResume() {
                navigator.geolocation.getCurrentPosition(function(position) {
                    lat = position.coords.latitude;
                    lng = position.coords.longitude;
                }, function() {
                    alert("Error al Obtener la Posición de su dispositivo, intente activar el GPS !");
                    location.href = "index.html";
                }, {enableHighAccuracy: true});
            }

            var lat, lng;
            var km = 3;

            function onDeviceReady() {
               
                navigator.geolocation.getCurrentPosition(function(position) {
                    lat = position.coords.latitude;
                    lng = position.coords.longitude;
                    jQuery('#buscar').liveSearch({url: 'http://tudomicilio.liceogalois.com/restaurante/buscar/'});
                }, function() {
                    alert("Error al Obtener la Posición de su dispositivo, intente activar el GPS !");
                    location.href = "index.html";
                }, {enableHighAccuracy: true});

                var dbExist = localStorage.getItem("dbExist");
                if (dbExist != "true") {
                    crearDb();
                }

                var pushNotification = window.plugins.pushNotification;

                if (device.platform == 'android' || device.platform == 'Android')
                {
                    //PARA ANDROID
                    pushNotification.register(
                            successHandler,
                            errorHandler, {
                                "senderID": "616270198580", //ID del proyecto  (Debes crear un proyecto en google developers -> https://console.developers.google.com/project )
                                "ecb": "onNotificationGCM"  //Metodo cuando llega una notificación
                            });
                }
                else
                {
                    //Para IOS
                    pushNotification.register(
                            tokenHandler,
                            errorHandler, {
                                "badge": "true",
                                "sound": "true",
                                "alert": "true",
                                "ecb": "onNotificationAPN"
                            });
                }

            }

            function crearDb() {
                var db = window.openDatabase("carrito", "1.0", "listacompraDB", 1000000);
                db.transaction(function(tx) {
                    tx.executeSql('CREATE TABLE IF NOT EXISTS lista (id unique, nombre, descripcion, precio, cantidad, indicaciones, idRestaurante)');
                });
                localStorage.setItem("dbExist", "true");
            }
            function eliminarDb() {
                var db = window.openDatabase("carrito", "1.0", "listacompraDB", 1000000);
                db.transaction(function(tx) {
                    tx.executeSql('DROP TABLE lista');
                });
                localStorage.setItem("dbExist", "false");
            }


            function lugaresCercanos() {
                location.href = "verCercanos.html";
            }
            function tipoRestaurantes() {
                location.href = "tipoRestaurantes.html";
            }
            function mostrarRestaurante(idRestaurante) {

                localStorage.setItem("idRestaurante", idRestaurante);
                location.href = "mostrarRestaurante.html";

            }
            function servicios(){
                location.href = "servicios.html";
            }
        </script>
    </head>
    <body>
        <div data-role="page" data-theme="b" id="pagina">

            <div data-role="header" data-position="fixed" data-fullscreen="false">
                <h3><img  src="image/header.png" style="width: 130px;margin-top: 4px" /></h3>
                <a href="#menu" id="btnMenu" style="border: none; background-color: #c5021a; box-shadow: none; margin-top: 11px" class="ui-nodisc-icon ui-btn ui-shadow ui-corner-all ui-icon-bars ui-btn-icon-notext ui-btn-a ui-btn-inline">Menù</a>
            </div>
            <div data-role="panel" data-display="overlay" data-position="left" id="menu">
                <input type="search" name="buscaRestaurante" id="buscaRestaurante" placeholder="Buscar Lugar">
                <div id="newSearch" style="width: 100%; z-index: 1000"></div> 
                <br>
                <ul data-role="listview" style="z-index: 0">
                    <li data-icon="home"><a data-ajax="false" href="index.html">Inicio</a></li>
                    <li data-icon="check"><a id="iniciar" data-ajax="false" href="iniciarSesion.html">Inicia Sesión</a></li>
                    <li data-icon="user"><a  id="perfil" data-ajax="false" href="perfil.html">Tu Perfil</a></li>
                    <li data-icon="info"><a id="estados" href="estado.html" data-ajax="false">Estado de Tus Domicilios</a></li>
                    <li data-icon="bullets"><a href="servicios.html" data-ajax="false">Otros Servicios</a></li>
                    <li data-icon="star"><a href="#" data-ajax="false" onclick="alert('Esta función estará disponible proximamente')">Favoritos</a></li>
                    <li data-icon="location"><a data-ajax="false" href="verCercanos.html">Lugares Cercanos</a></li>
                    <li data-icon="shop"><a data-ajax="false" href="tipoRestaurantes.html">Restaurantes</a></li>
                    <li data-icon="power"><a data-ajax="false" id="cerrar" href="#" onclick="cerrarSesion()">Cerrar Sesión</a></li>
                </ul>
            </div><!-- /panel -->
            <div role="main" class="ui-content" style="padding:  0">
                <ul class="rslides" id="slider">
                        <li><img src="image/SplashAndroid/ldpi.png" alt=""></li>
                        <li><img src="image/SplashAndroid/ldpi.png" alt=""></li>
                        <li><img src="image/SplashAndroid/ldpi.png" alt=""></li>
                </ul>
                <input type="file" name="datafile"  />
            </div>

        </div>
    </body>
</html>
